<!DOCTYPE HTML>
<html lang="en"> 
<head>
    <meta charset="utf-8"> 
    <title>Pathways: The Mind</title>

    <link rel="stylesheet" type="text/css" href="/_assets/build/css/main.css">

    <style type="text/css">
        
        .inner {
            max-width: 1024px;
            margin: 0 auto;
        }

        /* specific */
        .start {
            /*background: url('/_assets/img/james-t-matthews/jtm-1.jpg');*/
            /*background-attachment: fixed;*/
            /*background-size: 100%;*/
            z-index: -2;
        }

        .start .bg {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -5;
        }

        .start, .end {
            min-height: 600px;
        }

        .sequence:after, .sequence2:after {
            content: "";
            clear: left;
            display: block;
        }

        .panel {
            position: relative;
            min-height: 600px;
            color: #333;
        }

        .bg-container {
            height: 100%;
        }

        .bg {
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .bg img {
            display: block;
            width: 100%;
        }

        .sequence .scroll-content {
            position: absolute;
            top: 50%;
            left: 15%;
            background-color: rgba(0,0,0,0.8);
            color: #fff;
            padding: 15px;
            border-radius: 4px;
        }

        /* Second style of sequence */
        .sequence2 {
            position: relative;
        }

        .sequence2 .scroll-content {
            position: absolute;
            top: 10%;
            right: 5%;
        }

        .sequence2 .content {
            width: 35%;
            padding-left: 5%;
        }

        .sequence2 .panel-content {
            top: 10%;
            left: 5%;
            color: #fff;
            text-shadow: 1px 1px 0 #333;
            width: 35%;
        }

        .end {
            color: #fff;
        }

    </style>
</head>
<body>

    <main role="main">

        <div class="start">
            
            <div class="text">
                <div class="bg">
                    <img src="/_assets/img/james-t-matthews/jtm-1.jpg">
                </div>

                <p class="scene-set">
                    <span>1810</span>
                    <span>London</span>
                </p>

                <header>
                    <b>The Air Loom</b>
                    <h1>Can a machine control the mind?</h1>
                </header>

                <p class="intro-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo</p>  

            </div>

        </div>

        <div class="sequence">
            
            <div class="panel">
                <div class="bg-container">
                    <div class="bg">
                        <img src="/_assets/img/james-t-matthews/jtm-2.jpg">
                    </div>
                </div>

                <div class="scroll-content text">
                    <header>
                        <h1>The Air Loom</h1>
                    </header>
                </div>
            </div>

            <div class="panel">
                <div class="bg-container">
                    <div class="bg">
                        <img src="/_assets/img/james-t-matthews/jtm-3.jpg">
                    </div>
                </div>

                <div class="scroll-content img">
                    <p>Paragraph of text here</p>
                </div>
            </div>

        </div>

        <div class="sequence2">

            <div class="bg-container">
                <div class="bg">
                    <img src="/_assets/img/james-t-matthews/jtm-4.jpg">
                </div>
            </div>
            
            <div class="panel clearfix">
                <div class="panel-container">
                    <div class="panel-content">
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
                        cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                        proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    </div>
                </div>
                
                <div class="scroll-content img">
                    <img src="/_assets/img/interactions/e.jpg">
                </div>
            </div>

            <div class="panel clearfix">
                <div class="panel-container">
                    <div class="panel-content">
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
                        cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                        proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    </div>
                </div>

                <div class="scroll-content img">
                    <img src="/_assets/img/interactions/f.jpg">
                </div>
            </div>

            <div class="panel end">
                
                <div class="inner clearfix">
                    <header>
                        <h2>The notion of the machine is firmly planted in our culture</h2>
                    </header>

                    <div class="body">
                        <p>Braid announces that there is no longer any need to believe in animal magnetism, occult powers or vital energies.</p>
                    </div>

                    <div class="video-popup">
                        <a class="play-video talkinghead" data-width="640" data-height="360" title="" href="//www.youtube.com/embed/Zl6xwuBJVIY">Play Video</a>
                        <p>Author Mike Jay interviewed about Mesmer’s legacy.</p>
                    </div>
                </div>

            </div>

        </div>

        <!-- Library Layer -->
        <div class="library-layer">
            
            <div class="button"></div>

            <div class="gap">
                <div class="inner clearfix">
                    <ul>
                        <li><a href="#">Stuff!</a></li>
                        <li><a href="#">Help me!</a></li>
                        CHRONOLOGY 
                    </ul>

                    <ul>
                        <li><a href="#" data-embed="http://wellcomelibrary.org/package/b20458228">1700 A Guide to Magnetic Cures</a></li>
                        <li><a href="#" data-embed="http://wellcomelibrary.org/package/b20458228">1780 Mesmer’s First Manual</a></li>
                        <li><a href="#" data-embed="http://wellcomelibrary.org/package/b20458228">1792 Mesmer’s Second Manual</a></li>
                        <li><a href="#" data-embed="http://wellcomelibrary.org/package/b20458228">1980 History of Animal Magnetism</a></li>
                    </ul>
                </div>
            </div><!-- end Gap -->
        </div>

    </main>

    <script src="/_assets/js/lib/jquery-2.1.0.min.js"></script>
    <script src="/_assets/js/lib/hammer.min.js"></script>
    
    <script>

        var $window             = $(window),
            panel_height        = window.outerHeight < 800 ? 800 : window.outerHeight,
            
            $sequence           = $('.sequence'),
            sequence_top        = 0,
            sequence_height     = 0,
            sequence_triggered  = false,
            sequence_passed     = false,
            panels              = [],
            panel_tops          = [],
            panel_idx           = 0,

            $sequence2          = $('.sequence2'),
            sequence_top2       = 0,
            sequence_height2    = 0,
            sequence_triggered2 = false,
            sequence_passed2    = false,
            panels2             = [],
            panel_tops2         = [],
            panel_idx2          = 0,

            lastScrollY         = 0,
            ticking             = false;

        /**
         * Callback for our scroll event - just
         * keeps track of the last scroll value
         */
        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }

        /**
         * Calls rAF if it's not already
         * been done already
         */
        function requestTick() {
            if(!ticking) {
                requestAnimationFrame(parallaxAllTheThings);
                ticking = true;
            }
        }


        function parallaxAllTheThings(e) {

            // Scroll into the sequence
            if( lastScrollY > sequence_top && !sequence_triggered ) {
                // $('.start').find('.bg').css('display', 'none');
                $sequence.find('.bg').css({ position: 'fixed', opacity: 0 } );
                $sequence.find('.panel').first().find('.bg').css('opacity', 1);

                sequence_triggered = true;
            }

            // Scroll back before the sequence
            if( sequence_triggered && lastScrollY < sequence_top ) {
                // $('.start').find('.bg').css('display', 'block');
                $sequence.find('.bg').css({ position: 'static', display: 'block' } );

                sequence_triggered = false;
            }

            // Keep track of which panel we’re in
            if( sequence_triggered && lastScrollY > (panel_tops[panel_idx] + (panel_height / 4)) ) {
                if( panels[panel_idx+1] ) {
                    // fade in the next panel based on scroll distance of the previous panel to the top.
                    var unit    = 1 / (panel_height / 4),
                        delta   = lastScrollY - (panel_tops[panel_idx] + (panel_height / 4)),
                        opacity = unit * delta;

                    panels[panel_idx+1].find('.bg').css( 'opacity', opacity );

                    if( opacity >= 1 ) {
                        opacity = 1;
                        panel_idx++;
                    }

                }
            }

            // A little simpler going backward. Just check that the scroll is below the previous threshold and if so, drop the panel index back one
            // so it triggers the previous opacity calculations.
            if( panel_idx > 0 ) {
                if( lastScrollY < (panel_tops[panel_idx] + (panel_height / 4)) ) {
                    panel_idx--;
                }
            }


            // Reaches the end
            if( sequence_triggered && !sequence_passed && lastScrollY > (sequence_top + sequence_height - panel_height) ) {
                $sequence.find('.bg').css({ position: 'absolute' } );

                sequence_passed = true;
            }

            if( sequence_passed && lastScrollY < (sequence_top + sequence_height - panel_height) ) {
                $sequence.find('.bg').css({ position: 'fixed' } );

                sequence_passed = false;
            }


            /*
                Sequence 2
            */

            if( lastScrollY > sequence_top2 && !sequence_triggered2 ) {
                $sequence2.find('.bg').css({ position: 'fixed', top: 0, bottom: 'auto' } );

                sequence_triggered2 = true;
            }

            // Scroll back before the sequence
            if( sequence_triggered2 && lastScrollY < sequence_top2 ) {
                $sequence2.find('.bg').css({ position: 'absolute' } );

                sequence_triggered2 = false;
            }

            // Keep track of which panel we’re in
            if( sequence_triggered2 && lastScrollY > (panel_tops2[panel_idx2] - panel_height) ) {
                panels2[panel_idx2].find('.panel-content').fadeIn(500);
            }

            if( sequence_triggered2 && lastScrollY > (panel_tops2[panel_idx2] - panel_height + 400) ) {
                panels2[panel_idx2++].find('.panel-content').fadeOut(500);
            }


            // Reaches the end
            if( sequence_triggered2 && !sequence_passed2 && lastScrollY > (sequence_top2 + sequence_height2 - panel_height) ) {
                $sequence2.find('.bg').css({ position: 'absolute', top: 'auto', bottom: 0, height: 'auto' } );

                sequence_passed2 = true;
            }

            if( sequence_passed2 && lastScrollY < (sequence_top2 + sequence_height2 - panel_height) ) {
                $sequence2.find('.bg').css({ position: 'fixed', top: 0, bottom: 'auto' } );

                sequence_passed2 = false;
            }

            // allow further rAFs to be called
            ticking = false;
        }

        function resizeAllTheThings() {
            $('.start').css('height', panel_height);
            $('.panel').css('height', panel_height);
        }

        function init() {
            resizeAllTheThings();

            $('.panel', $sequence).each(function() {
                var $this = $(this);

                panels.push( $this );
                panel_tops.push( $this.offset().top )

                sequence_height += $this.height();
            });

            $('.panel', $sequence2).each(function() {
                var $this = $(this);

                panels2.push( $this );
                panel_tops2.push( $this.offset().top )

                sequence_height2 += $this.height();
            });

            $sequence.css('height', sequence_height);
            sequence_top    = $('.sequence').offset().top;
            sequence_top2   = $('.sequence2').offset().top;

            $sequence2.find('.panel-content').css({ position: 'fixed', display: 'none' } );
        }

        window.addEventListener('scroll', onScroll);
        window.addEventListener('resize', resizeAllTheThings);
        window.addEventListener('load', init);
    </script>

</body>
</html>
